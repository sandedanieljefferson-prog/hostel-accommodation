<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payment - Hostelhub</title>
<link rel="stylesheet" href="theme.css">
<style>
    body { margin:0; font-family:'Segoe UI', Arial, sans-serif; background:#293deb; color:#222; }
    .container { max-width:1100px; margin:40px auto 100px auto; background:#7178dd; border-radius:16px; box-shadow:0 2px 16px rgba(0,0,0,0.07); padding:40px 30px; }
    .header-row { display:flex; align-items:center; justify-content:space-between; position:relative; }
    .header-side { width:80px; display:flex; align-items:center; justify-content:flex-start; }
    .header-center { flex:1; display:flex; justify-content:center; align-items:center; position:absolute; left:0; right:0; pointer-events:none; }
    .header-center h1 { color:red; font-size:2.5rem; margin:0; pointer-events:auto; }
    #dashboardIcon { cursor:pointer; margin-left:0; }
    #dashboardIcon img { width:40px; height:40px; border-radius:50%; vertical-align:middle; }
    .register-link img { width:40px; height:40px; border-radius:20px; }
    #dashboardMenu { display:none; position:absolute; right:40px; top:90px; background:#fff; color:#222; border-radius:12px; box-shadow:0 2px 12px rgba(0,0,0,0.15); padding:18px 24px; z-index:2000; }
    #dashboardMenu ul { list-style:none; padding:0; margin:0; }
    #dashboardMenu li { margin-bottom:10px; }
    #dashboardMenu li:last-child { margin-bottom:0; }
    input[type="text"], input[type="number"], select { width:90%; padding:12px; margin:10px 0 20px 0; border:1.5px solid #452B1F; border-radius:8px; font-size:1rem; }
    button[type="submit"] { background:#452B1F; color:#fff; border:none; border-radius:20px; padding:12px 32px; font-size:1.1rem; cursor:pointer; transition:background 0.2s; }
    button[type="submit"]:hover { background:#ff4d4d; }
    .footer { background:#452B1F; color:#fff; text-align:center; padding:24px 0 16px 0; position:fixed; width:100vw; bottom:0; left:0; z-index:1000; }
    #hostelDisplay { font-weight:bold; color:#452B1F; margin-bottom:16px; display:block; font-size:1.3rem; }
</style>
</head>
<body>
<div class="container">
    <div class="header-row">
        <div class="header-side">
            <span id="dashboardIcon">
                <img src="dashboard.png" alt="Dashboard">
            </span>
        </div>
        <div class="header-center">
            <h1>HOSTELHUB</h1>
        </div>
        <div class="header-side" style="justify-content:flex-end;">
            <a class="register-link" href="login.html"><img src="regester.jpeg" alt="Register/Login"></a>
        </div>
    </div>
    <div id="dashboardMenu">
        <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="terms.html">Terms & Conditions</a></li>
            <li><a href="help.html">Help & FAQs</a></li>
            <li><a href="hostels.html">Available Hostels</a></li>
            <li><a href="bookings.html">Bookings</a></li>
            <li><a href="login.html">Login</a></li>
            <li><a href="register.html">Register</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </div>

    <h1>Payment</h1>
    <span id="hostelDisplay">Loading hostel...</span>
    <form id="paymentForm">
    <label>Mobile Money Network:</label><br>
        <select id="network" required>
            <option value="">Select Network</option>
            <option value="MTN">MTN</option>
            <option value="Airtel">Airtel</option>
        </select><br>
    <label>Country Code:</label><br>
        <select id="countryCode" required>
            <option value="+256">Uganda (+256)</option>
            <option value="+254">Kenya (+254)</option>
            <option value="+255">Tanzania (+255)</option>
        </select><br>
    <input type="text" id="phoneNumber" placeholder="Phone Number" required><br>
    <input type="number" id="amount" placeholder="Amount" required><br>
    <button type="submit">Complete Payment</button>
    </form>
    <div id="paymentSuccess" style="display:none; color:green; font-weight:bold; margin-top:12px;"></div>
</div>
<footer class="footer"></footer>

<script>
document.getElementById('dashboardIcon').onclick = function(e){
    e.stopPropagation();
    const menu=document.getElementById('dashboardMenu');
    menu.style.display = menu.style.display==='block'?'none':'block';
};
document.body.onclick = function(){ document.getElementById('dashboardMenu').style.display='none'; };

// Load hostel name and image from localStorage
window.onload = function(){
    const hostelName = localStorage.getItem('payHostelName') || 'Unknown Hostel';
    const hostelImg = localStorage.getItem('payHostelImg') || '1 (2).jpg';
    const hostelDisplay = document.getElementById('hostelDisplay');
    hostelDisplay.innerText = hostelName;
    hostelDisplay.style.backgroundImage = `url('${hostelImg}')`;
    // i18n removed
};

const form=document.getElementById('paymentForm');
form.onsubmit = function(e){
    e.preventDefault();
    const hostelName = localStorage.getItem('payHostelName') || 'Unknown Hostel';
    const hostelImg = localStorage.getItem('payHostelImg') || '1 (2).jpg';
    const loggedInUser = localStorage.getItem('loggedInUser') || 'N/A';
    const price = parseInt(localStorage.getItem('payPrice')||'0')||0;

    const payments = JSON.parse(localStorage.getItem('payments') || '[]');
    const amountVal = parseInt(document.getElementById('amount').value)||0;
    payments.push({
        user: loggedInUser,
        hostel: hostelName,
        hostelId: localStorage.getItem('payHostelId') ? parseInt(localStorage.getItem('payHostelId')) : null,
        img: hostelImg,
        network: document.getElementById('network').value,
        number: document.getElementById('phoneNumber').value,
        amount: amountVal,
        price: price,
        // compute true balance after this payment by summing previous payments for this hostel by the user
        balance: (function(){
            try{
                const all = JSON.parse(localStorage.getItem('payments')||'[]');
                const hostelKey = hostelName;
                const previous = all.filter(pp => (pp.user===loggedInUser) && ((pp.hostelId && pp.hostelId=== (localStorage.getItem('payHostelId')?parseInt(localStorage.getItem('payHostelId')):null)) || (pp.hostel||'')===hostelKey));
                const totalPrev = previous.reduce((s,pp)=> s + (parseInt(pp.amount,10)||0),0);
                return Math.max(0, price - (totalPrev + amountVal));
            }catch(e){ return Math.max(0, price - amountVal); }
        })(),
        timestamp: new Date().toISOString()
    });
    localStorage.setItem('payments', JSON.stringify(payments));

    let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
    const payIndex = parseInt(localStorage.getItem('payIndex'));
    if(!isNaN(payIndex) && bookings[payIndex]) bookings.splice(payIndex,1);
    localStorage.setItem('bookings', JSON.stringify(bookings));

    localStorage.removeItem('payIndex');
    localStorage.removeItem('payHostelName');
    localStorage.removeItem('payHostelImg');
    localStorage.removeItem('payPrice');

    const successMsg = document.getElementById('paymentSuccess');
    successMsg.style.display='block';
    successMsg.innerText=`Payment successful for ${hostelName}! Redirecting...`;
    setTimeout(()=>{ window.location.href='bookings.html'; },2000);
};
</script>

<script src="script.js"></script>
</body>
</html>
